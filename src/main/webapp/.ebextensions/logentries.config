option_settings:
  - option_name: LOGENTRIES_CONFIG_PATH
    value: /etc/le/config

files:
  "/etc/yum.repos.d/logentries.repo":
    mode: "000664"
    owner: root
    group: root
    content: |
      [logentries]
      name=Logentries repo
      enabled=1
      metadata_expire=1d
      baseurl=http://rep.logentries.com/amazonlatest/\$basearch
      gpgkey=http://rep.logentries.com/RPM-GPG-KEY-logentries
    encoding: plain

commands:
  01-install-logentries:
    command: |
      yum update
      yum install logentries -y
      yum install logentries-daemon -y

container_commands:
  02-create-logentries-config:
    command: |
      mkdir -p /etc/le
      rm -f $LOGENTRIES_CONFIG_PATH
      echo [Main] > $LOGENTRIES_CONFIG_PATH
      echo user-key = $LOGENTRIES_USER_KEY >> $LOGENTRIES_CONFIG_PATH
      echo pull-server-side-config=False >> $LOGENTRIES_CONFIG_PATH
      echo >> $LOGENTRIES_CONFIG_PATH
      echo [name] >> $LOGENTRIES_CONFIG_PATH
      echo path = /var/log/tomcat8/catalina.out >> $LOGENTRIES_CONFIG_PATH
      echo destination = Bridge-UDD-$ENV/Bridge-UDD-$ENV >> $LOGENTRIES_CONFIG_PATH
  03-restart-logentries:
    command: /sbin/service logentries start
